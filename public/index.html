<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6134759270953813"
     crossorigin="anonymous"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta property="og:title" content="PLACEHOLDER_OG_TITLE">
<meta property="og:description" content="PLACEHOLDER_OG_DESC">
<meta property="og:image" content="PLACEHOLDER_OG_IMAGE">
<meta property="og:url" content="PLACEHOLDER_OG_URL">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="PLACEHOLDER_OG_TITLE">
<meta name="twitter:description" content="PLACEHOLDER_OG_DESC">
<meta name="twitter:image" content="PLACEHOLDER_OG_IMAGE">

  <title>STEAV NEWS</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Battambang:wght@400;700&family=Noto+Sans+Khmer:wght@400;700&display=swap" rel="stylesheet">
 <link rel="icon" href="/uploads/images/favicon.jpg" type="image/jpeg"> <!-- Favicon added -->
<style>
    /* Add new styles for category spotlight and overall layout */
    .category-spotlight-section {
        background-color: #fff; /* White background */
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .category-spotlight-section h2 {
        text-align: center;
        color: #e60000;
        margin-bottom: 25px;
        font-size: 1.8rem;
    }

    .category-spotlight-grid {
        display: grid;
        /* Adjusted minmax to make cards larger or fit fewer per row */
        grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); /* Increased min-width */
        gap: 20px;
        justify-content: center;
    }

    .category-spotlight-card {
        display: flex;
        flex-direction: column;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        text-decoration: none;
        color: inherit;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        background-color: #f9f9f9;
    }

    .category-spotlight-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .category-spotlight-card .card-image {
        width: 100%;
        height: 220px; /* Increased height for larger cards */
        overflow: hidden;
    }

    .category-spotlight-card .card-image img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* Ensures image covers the area without distortion */
        transition: transform 0.3s ease;
    }

    .category-spotlight-card:hover .card-image img {
        transform: scale(1.05);
    }

    .category-spotlight-card .card-content {
        padding: 15px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .category-spotlight-card .card-content .card-category {
        font-size: 1rem; /* Further increased font size for better visibility */
        color: #e60000;
        font-weight: bold;
        margin-bottom: 5px;
        text-transform: uppercase;
    }

    .category-spotlight-card .card-content h3 {
        font-size: 1.3rem; /* Further increased font size */
        margin-top: 0;
        margin-bottom: 10px;
        color: #333;
        line-height: 1.2em; /* Adjusted line height for 3-4 lines */
        height: 3.6em; /* 1.2em * 3 lines (for max 3 lines) - adjusted */
        overflow: hidden; /* Hide overflowing text */
        text-overflow: ellipsis; /* Add ellipsis */
        display: -webkit-box; /* For multi-line ellipsis */
        -webkit-line-clamp: 3; /* Changed to 3 lines */
        -webkit-box-orient: vertical; /* Required for -webkit-box-orient */
        font-family: 'Battambang', 'Khmer OS Siemreap', 'Noto Sans Khmer', Arial, sans-serif; /* Applied Khmer font */
    }

    .category-spotlight-card .card-content .card-date {
        font-size: 0.8rem; /* Slightly increased font size */
        color: #777;
        text-align: right;
        margin-top: auto; /* Push date to bottom */
    }

    /* Styles for category label on general news cards */
    .news-cards .card-content .card-category { /* This will be removed from latest articles cards */
        font-size: 1rem; /* Increased font size */
        color: #e60000; /* K-Pop Red */
        font-weight: bold;
        margin-bottom: 5px;
        text-transform: uppercase;
    }


    /* Adjust main content grid for better spacing */
    .main-content-grid {
        display: grid;
        grid-template-columns: 1fr; /* Default to single column for small screens */
        gap: 30px;
        max-width: 1200px;
        margin: 20px auto;
        padding: 0 20px; /* Default horizontal padding for desktop */
    }

    @media (min-width: 768px) {
        .main-content-grid {
            grid-template-columns: 2.5fr 1fr; /* Two columns for larger screens */
        }
        /* Make trending section sticky */
        .main-content-grid aside.trending {
            position: sticky;
            top: 20px; /* Adjust as needed */
            align-self: start; /* Prevents stretching */
            height: fit-content; /* Prevents overflow */
        }
    }

    /* Ensure other card styles from styles.css remain compatible */
    .news-cards {
        display: grid;
        /* Changed to explicitly 2 columns for laptop/desktop size */
        grid-template-columns: repeat(2, 1fr);
        gap: 25px; /* Keep consistent gap for non-mobile */
    }

    /* Adjustments for .news-cards (Latest Articles) */
    .news-cards .card {
        min-height: 280px; /* Increased min-height */
    }

    .news-cards .card-image {
        padding-bottom: 65%; /* Slightly increased aspect ratio for more vertical space */
    }

    .news-cards .card-content h3 {
        font-size: 1.1rem; /* Increased font size */
        line-height: 1.2em; /* Ensure sufficient line height for 3 lines */
        height: 3.6em; /* 1.2 * 3 lines */
        overflow: hidden; /* Hide overflowing text */
        text-overflow: ellipsis; /* Add ellipsis */
        display: -webkit-box; /* For multi-line ellipsis */
        -webkit-line-clamp: 3; /* Changed to 3 lines */
        -webkit-box-orient: vertical; /* Required for -webkit-box-orient */
        /* Ensure that news cards titles also use Battambang font if they aren't inheriting it */
        font-family: 'Battambang', 'Khmer OS Siemreap', 'Noto Sans Khmer', Arial, sans-serif;
    }
    .news-cards .card-content .card-date {
        font-size: 0.8rem; /* Slightly increased font size */
    }

    /* Navbar font update */
    .nav-links a {
      font-size: 20px;
        font-family: 'Battambang', 'Khmer OS Siemreap', 'Noto Sans Khmer', Arial, sans-serif;
        font-weight: bold; /* Explicitly set to bold */
    }

    /* Specific adjustments for Category Spotlight grid on smaller screens */
    @media (max-width: 767px) { /* Adjust breakpoint if needed */
        .category-spotlight-grid {
            grid-template-columns: repeat(2, 1fr); /* Force 2 columns on mobile/small tablets */
            gap: 10px; /* Reduced gap for tighter fit in category spotlight */
        }

        .category-spotlight-card { /* Unified card height for mobile spotlights */
            min-height: 180px; /* Matched to news cards min-height for consistency */
        }

        .category-spotlight-card .card-image {
            height: auto; /* Allow auto height */
            padding-bottom: 55%; /* Match news card image aspect ratio */
        }

        .category-spotlight-card .card-content {
            padding: 8px; /* Reduced padding for category spotlight content */
        }

        .category-spotlight-card .card-content .card-category {
            font-size: 1rem; /* Increased for mobile category spotlights */
            margin-bottom: 3px;
        }

        .category-spotlight-card .card-content h3 {
            font-size: 0.9rem; /* Reduced to match news card title size */
            line-height: 1.1em; /* Even tighter line height */
            height: 3.3em; /* 1.1 * 3 lines for 3-line title */
            -webkit-line-clamp: 3; /* Changed to 3 lines */
            margin-bottom: 5px;
        }
        .category-spotlight-card .card-content .card-date {
            font-size: 0.7rem; /* Even smaller date font */
        }


        /* --- Mobile-specific adjustments for .news-cards (Latest Articles) --- */
        .news-section {
            background-color: #fff; /* White background for mobile */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Shadow for mobile */
            border-radius: 8px; /* Rounded corners for mobile */
            padding: 15px; /* Adjusted padding for the section itself */
            margin: 0; /* Remove all margins to allow full width stretch */
            width: 100%; /* Ensure full width */
        }
        .news-section h2 {
            padding-top: 0; /* Remove top padding within the section */
            text-align: left; /* Align heading left for mobile */
            font-size: 1.7rem; /* Smaller headings */
        }
        .news-cards {
            gap: 8px; /* Further reduced gap between cards on mobile for a very tight look */
        }

        .news-cards .card {
            min-height: 180px; /* Reduced min-height for shorter cards (unified) */
        }

        .news-cards .card-image {
            padding-bottom: 55%; /* Unified image aspect ratio for mobile */
        }

        .news-cards .card-content {
            padding: 8px; /* Further reduced padding for more compact content */
        }

        .news-cards .card-content h3 {
            font-size: 0.9rem; /* Further reduced font size for mobile article titles */
            line-height: 1.1em; /* Even tighter line height */
            height: 3.3em; /* 1.1 * 3 lines for 3-line title */
            -webkit-line-clamp: 3; /* Changed to 3 lines for mobile */
            margin-bottom: 5px;
        }

        .news-cards .card-content .card-category { /* This will be hidden below */
            display: none; /* Hide category name on mobile cards */
        }
        .news-cards .card-content .card-date {
            font-size: 0.7rem; /* Adjusted font size for date on mobile cards */
            text-align: left; /* Align date left for consistency with new layout */
        }

        /* Adjust main-content-grid padding for mobile to allow sections to have their own padding/margin */
        .main-content-grid {
            padding: 0; /* Remove padding from main-content-grid on mobile */
            gap: 20px; /* Adjust gap between main grid items */
        }

        /* Category Spotlight section on mobile */
        .category-spotlight-section {
            padding: 15px; /* Consistent padding */
            margin: 0 0 20px 0; /* Removed horizontal margin, only bottom margin */
            width: 100%; /* Full width */
        }
        .category-spotlight-section h2 {
            text-align: left; /* Align heading left for mobile */
        }
    }

    /* Default (desktop) styles for .news-section */
    .news-section {
        background-color: #fff; /* White background */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Shadow */
        border-radius: 8px; /* Rounded corners */
        padding: 20px; /* Default padding for desktop */
        margin-bottom: 20px; /* Default margin for desktop */
    }

    /* Footer Quick Links Font Update */
    .footer-links ul li a { /* Target specific links within footer list */
        font-family: 'Battambang', 'Khmer OS Siemreap', 'Noto Sans Khmer', Arial, sans-serif;
        font-weight: bold; /* Apply bold font weight */
        font-size: 1.1rem; /* Slightly increased font size for better readability on desktop/laptop */
        color: #bbb; /* Ensure color is consistent */
    }
    .footer-links h3 { /* Ensure heading font size is good */
        font-size: 1.2rem;
    }
    .footer-social h3 { /* Ensure heading font size is good */
        font-size: 1.2rem;
    }
    .social-icons a { /* Adjust social icons font size too if needed */
        font-size: 24px;
    }

    @media (min-width: 769px) { /* Adjustments for larger screens (laptop/desktop) */
        .footer-sections-wrapper {
            justify-content: space-around; /* Distribute items with space around */
            align-items: flex-start; /* Align sections to their start (top) */
            max-width: 800px; /* Limit overall width for better grouping */
            margin: 0 auto; /* Center the wrapper */
            padding: 0 20px; /* Add some padding if the wrapper is too wide */
            flex-wrap: nowrap; /* Prevent wrapping on large screens */
        }
        .footer-links, .footer-social {
            flex-basis: auto; /* Allow natural width */
            min-width: unset; /* Remove min-width constraint */
            flex-grow: 0; /* Don't grow unnecessarily */
            text-align: left; /* Keep text aligned left */
        }
        .social-icons {
            justify-content: flex-start; /* Align social icons to the left */
        }
        /* Further adjust spacing and font for footer links on laptops */
        .footer-links ul {
            display: block; /* Stack list items vertically again for desktop */
        }
        .footer-links ul li {
            margin-bottom: 10px; /* Space out vertical list items */
        }
    }

    /* Footer specific adjustments for alignment of copyright and line */
    .footer-bottom {
        border-top: 1px solid #555;
        padding-top: 20px;
        margin-top: 20px;
        width: 100%; /* Ensure it spans full width of its parent */
        max-width: 1200px; /* Match main content max-width */
        margin-left: auto; /* Center horizontally */
        margin-right: auto; /* Center horizontally */
        text-align: center; /* Center the text content */
        color: #aaa;
    }

    .site-footer {
        text-align: center; /* Ensure overall footer content is centered initially */
    }
</style>
</head>
<body>
  <header class="navbar">
    <div class="logo">STEAV<br />NEWS</div>

    <button class="hamburger" onclick="toggleMenu()">☰</button>

    <nav class="nav-links" id="navLinks">
      <a href="index.html">ទំព័រដើម</a>
      <a href="index.html?category=កម្សាន្ត">កម្សាន្ត</a>
      <a href="index.html?category=សង្គម">សង្គម</a>
      <a href="index.html?category=កីឡា">កីឡា</a>
      <a href="index.html?category=ពិភពលោក">ពិភពលោក</a>
    </nav>
  </header>

  <section class="carousel-container">
    <div class="carousel" id="carousel">
      <div class="carousel-slide active">
        <img src="/uploads/images/banner1.jpg" alt="Ad 1" />
      </div>
      <div class="carousel-slide">
       <img src="/uploads/images/banner2.jpg" alt="Ad 1" />
      </div>
      <div class="carousel-slide">
        <img src="/uploads/images/banner3.jpg" alt="Ad 1" />
      </div>
    </div>
    <div class="carousel-nav">
      <button class="nav-button prev" onclick="prevSlide()">&#10094;</button>
      <button class="nav-button next" onclick="nextSlide()">&#10095;</button>
    </div>
  </section>

  <main class="main-content-grid">
    <div class="left-column">
        <section class="category-spotlight-section" id="categorySpotlightSection">
            <h2 style="font-family: 'Battambang'">Highlights</h2>
            <div class="category-spotlight-grid" id="categorySpotlightGrid">
                <p style="text-align: center; grid-column: 1 / -1; color: #888;">Loading category highlights...</p>
            </div>
        </section>

        <section class="news-section">
            <h2 id="articlesSectionTitle">Latest Articles</h2>
            <div class="news-cards">
                </div>
        </section>
    </div>
    <aside class="trending">
      <h2>Trending Now</h2>
      <ul id="trendingList">
      </ul>
    </aside>
  </main>

  <footer id="mainFooter" class="site-footer">
    <div class="footer-content">
      <div class="footer-logo">STEAV<br />NEWS</div>
      <div class="footer-sections-wrapper">
        <div class="footer-links">
          <h3>Quick Links</h3>
          <ul>
            <li><a href="index.html">ទំព័រដើម</a></li>
            <li><a href="index.html?category=កម្សាន្ត">កម្សាន្ត</a></li>
            <li><a href="index.html?category=សង្គម">សង្គម</a></li>
            <li><a href="index.html?category=កីឡា">កីឡា</a></li>
            <li><a href="index.html?category=ពិភពលោក">ពិភពលោក</a></li>
          </ul>
        </div>
      <div class="footer-social">
  <h3>Follow Us</h3>
  <div class="social-icons">
    <a href="https://facebook.com" target="_blank" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
    <a href="https://twitter.com" target="_blank" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
    <a href="https://instagram.com" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
  </div>
</div>
      </div> </div> <div class="footer-bottom">
      &copy; 2025 STEAV NEWS. All rights reserved.
    </div>
  </footer>

  <script>
    // Navbar toggle for mobile
    function toggleMenu() {
      const nav = document.getElementById("navLinks");
      nav.classList.toggle("open");
    }

    // Carousel functionality
    let currentSlide = 0;
    const slides = document.querySelectorAll(".carousel-slide");
    const totalSlides = slides.length;

    function showSlide(index) {
      // Remove 'active' from all slides
      slides.forEach(slide => slide.classList.remove("active"));
      // Add 'active' to the current slide
      slides[index].classList.add("active");
      currentSlide = index;
    }

    function nextSlide() {
      currentSlide = (currentSlide + 1) % totalSlides;
      showSlide(currentSlide);
    }

    function prevSlide() {
      currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
      showSlide(currentSlide);
    }

    // Initialize carousel to show the first slide
    showSlide(currentSlide);

    // Auto-advance carousel
    setInterval(nextSlide, 5000); // Change slide every 5 seconds

    // --- Fetch and display CATEGORY SPOTLIGHT articles ---
    async function fetchCategorySpotlights() {
        const categorySpotlightSection = document.getElementById("categorySpotlightSection"); // Get the whole section
        const categorySpotlightGrid = document.getElementById("categorySpotlightGrid");
        const urlParams = new URLSearchParams(window.location.search);
        const categoryFilter = urlParams.get('category');

        // Hide the section if a category filter is active
        if (categoryFilter) {
            categorySpotlightSection.style.display = 'none';
            return; // Exit function early
        } else {
            categorySpotlightSection.style.display = 'block'; // Ensure it's visible on Home
        }

        categorySpotlightGrid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: #888;">Loading category highlights...</p>';

        try {
            const response = await fetch('/api/categories/homepage-previews');
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
            }
            const articles = await response.json();

            categorySpotlightGrid.innerHTML = "";

            if (articles.length === 0) {
                categorySpotlightGrid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: #888;">No category spotlights available yet. Add articles with categories in the admin panel!</p>';
            } else {
                articles.forEach(article => {
                    const card = document.createElement("a");
                    card.href = `article.html?id=${article._id}`;
                    card.classList.add("category-spotlight-card");
                    const articleDate = article.createdAt
                        ? new Date(article.createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })
                        : (article.date || 'Unknown Date');

                    card.innerHTML = `
                        <div class="card-image">
                            <img src="${article.image || 'https://placehold.co/400x250/cccccc/ffffff?text=No+Image'}" alt="${article.title}" loading="lazy"/>
                        </div>
                        <div class="card-content">
                            <p class="card-category">${article.category || 'General'}</p>
                            <h3>${article.title}</h3>
                            <p class="card-date">${articleDate}</p>
                        </div>`;
                    categorySpotlightGrid.appendChild(card);
                });
            }
        } catch (err) {
            console.error("Failed to fetch category spotlights:", err);
            categorySpotlightGrid.innerHTML = `<p style="color: red; text-align: center; grid-column: 1 / -1;">Failed to load category spotlights: ${err.message}. Please ensure your server is running and articles have categories assigned.</p>`;
        }
    }

    // --- Fetch and display LATEST articles (or filtered by category) ---
    async function fetchArticles() {
        const articlesSectionTitle = document.getElementById("articlesSectionTitle");
        const newsCardsContainer = document.querySelector(".news-cards");
        const urlParams = new URLSearchParams(window.location.search);
        const categoryFilter = urlParams.get('category');

        let apiUrl = '/api/articles';
        if (categoryFilter) {
            apiUrl += `?category=${encodeURIComponent(categoryFilter)}`;
            articlesSectionTitle.textContent = `${categoryFilter}`; /* Removed " Articles" */
        } else {
            articlesSectionTitle.textContent = 'Latest Articles';
        }

        newsCardsContainer.innerHTML = '<p style="text-align: center; width: 100%;">Loading articles...</p>';

        try {
            const res = await fetch(apiUrl);
            if (!res.ok) {
                const errorText = await res.text();
                throw new Error(`HTTP error! status: ${res.status} - ${errorText}`);
            }
            const articles = await res.json();

            newsCardsContainer.innerHTML = "";

            if (articles.length === 0) {
                newsCardsContainer.innerHTML = `<p style="text-align: center; width: 100%; color: #888;">No articles found ${categoryFilter ? `in the '${categoryFilter}' category` : ''}.</p>`;
            } else {
                articles.forEach(article => {
                    const card = document.createElement("a");
                    card.href = `article.html?id=${article._id}`;
                    card.classList.add("card");
                    const articleDate = article.createdAt
                        ? new Date(article.createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })
                        : (article.date || 'Unknown Date');

                    card.innerHTML = `
                        <div class="card-image">
                            <img src="${article.image || 'https://placehold.co/400x250/cccccc/ffffff?text=No+Image'}" alt="${article.title}" loading="lazy"/>
                        </div>
                        <div class="card-content">
                            <!-- Removed category name from Latest Articles cards -->
                            <p class="card-date">${articleDate}</p>
                            <h3>${article.title}</h3>
                        </div>`;
                    newsCardsContainer.appendChild(card);
                });
            }
        } catch (err) {
            console.error("Failed to fetch articles:", err);
            newsCardsContainer.innerHTML = `<p style="color: red; text-align: center; width: 100%;">Failed to load articles: ${err.message}.</p>`;
        }
    }


    // Fetch and display trending articles for the "Trending Now" section
    fetch('/api/trending')
      .then(res => res.json())
      .then(trendingArticles => {
        const trendingList = document.getElementById("trendingList");
        trendingList.innerHTML = "";
        if (trendingArticles.length === 0) {
          trendingList.innerHTML = '<li>No trending articles found.</li>';
          return;
        }
        trendingArticles.forEach(item => {
          const li = document.createElement('li');
          li.innerHTML = `
            <a href="article.html?id=${item._id}">
              <img src="${item.image || 'https://placehold.co/100x60/cccccc/ffffff?text=No+Image'}" alt="${item.title}" loading="lazy"/>
              <span>${item.title}</span>
            </a>`;
          trendingList.appendChild(li);
        });
      })
      .catch(err => console.error("Failed to fetch trending articles:", err));

    // Call initial fetch functions on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
        fetchCategorySpotlights(); // Fetches the distinct category previews (now conditional)
        fetchArticles(); // Fetches the main list of articles (filtered or all)
    });

    // Listen for changes in the URL (e.g., when a category link is clicked, or browser back/forward)
    window.addEventListener('popstate', () => {
        fetchCategorySpotlights(); // Re-evaluate visibility of spotlights
        fetchArticles(); // Re-fetch articles based on new URL (category filter)
    });
    // This script should be placed at the end of <body>.
  </script>
</body>
</html>
